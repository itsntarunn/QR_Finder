<!DOCTYPE html>
<html>
<head>
  <title>QR Finder Debug</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial; padding:20px; text-align:center; background:#f5f5f5; }
    input { padding:10px; width:70%; max-width:300px; text-transform:uppercase; margin-bottom:10px;}
    button { padding:10px 15px; margin:5px; }
    #result img { margin-top:20px; width:80%; max-width:400px; border:2px solid #333; border-radius:10px; cursor:pointer; }
    #result p { margin-top:20px; font-size:1.2rem; color:red; }
    #zoomOverlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); justify-content:center; align-items:center; z-index:1000; }
    #zoomOverlay img { max-width:90%; max-height:90%; border-radius:10px; }
  </style>
</head>
<body>

<h2>Find QR Code (Debug)</h2>
<input id="bag" placeholder="A1-1A">
<div>
  <button onclick="findQR()">Search</button>
  <button onclick="newSearch()">New Search</button>
</div>

<div id="result"></div>

<div id="zoomOverlay" onclick="closeZoom()">
  <img id="zoomImg" src="">
</div>

<!-- Include combined JS -->
<script src="all_qr.js"></script>

<script>
  const input = document.getElementById("bag");
  const result = document.getElementById("result");

  console.log("DEBUG: Loaded HTML and JS");

  // Show total QR codes loaded
  if (typeof qrMap !== "undefined") {
    console.log("DEBUG: qrMap exists!");
    console.log("DEBUG: Total QR codes in map:", Object.keys(qrMap).length);
    console.log("DEBUG: Sample keys:", Object.keys(qrMap).slice(0,10));
  } else {
    console.error("DEBUG: qrMap is undefined! JS not loaded correctly.");
  }

  function findQR() {
    const bag = input.value.trim().toUpperCase();
    console.log("DEBUG: Searching for bag number:", bag);
    result.innerHTML = "";

    if (!bag) return;

    if (typeof getQR === "function") {
      const qr = getQR(bag);
      console.log("DEBUG: getQR returned:", qr);

      if (qr) {
        const img = new Image();
        img.src = qr;
        img.alt = bag;
        img.onclick = () => zoomImage(img.src);
        result.appendChild(img);
      } else {
        result.innerHTML = "<p>‚ùå QR image could not be loaded or not found</p>";
      }
    } else {
      console.error("DEBUG: getQR function not found!");
    }
  }

  function newSearch() {
    input.value = "";
    result.innerHTML = "";
    input.focus();
  }

  function zoomImage(src) {
    const overlay = document.getElementById("zoomOverlay");
    const zoomImg = document.getElementById("zoomImg");
    zoomImg.src = src;
    overlay.style.display = "flex";
  }

  function closeZoom() {
    document.getElementById("zoomOverlay").style.display = "none";
  }

  input.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') findQR();
  });
</script>

</body>
</html>
